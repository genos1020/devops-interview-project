alertmanager:
  alertmanagerSpec:
    # 1. 告訴 Operator 使用你自定義的 Secret 名稱
    configSecret: alertmanager-config

    # 2. 掛載存放 Token 的 Secret
    # 這會自動掛載到 /etc/alertmanager/secrets/alertmanager-telegram
    secrets:
      - alertmanager-telegram

# ---- 關閉 EKS 託管的 control plane 元件監控 ----
# 這些元件由 AWS 管理，無法 scrape，開著只會產生誤報
kubeScheduler:
  enabled: false

kubeControllerManager:
  enabled: false

kubeEtcd:
  enabled: false

kubeProxy:
  enabled: false

# ---- 自訂告警規則 ----
additionalPrometheusRulesMap:
  app-alerts:
    groups:
      - name: app-down
        rules:
          - alert: AppDown
            expr: kube_deployment_status_replicas_available{deployment="my-nginx-nginx-chart",namespace="default"} == 0
            for: 1m
            labels:
              severity: critical
            annotations:
              summary: "應用程式無可用 Pod 超過 1 分鐘"
              description: "deployment my-nginx-nginx-chart 已無可用 replicas 超過 1 分鐘"
          - alert: MyNginxScaledToZero
            expr: kube_deployment_spec_replicas{deployment="my-nginx-nginx-chart",namespace="default"} == 0
            for: 0s
            labels:
              severity: critical
            annotations:
              summary: "my-nginx replicas is 0"